name: End of Session – Auto-Documentation
on:
  workflow_dispatch:
    inputs:
      session_notes:
        type: string
        default: 'Session closed – repo updated'
        required: false
        description: 'Quick notes for today (optional)'

jobs:
  document:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GROK_PAT }}
          persist-credentials: true

      - name: Update README
        run: |
          DATE=$(date +"%Y-%m-%d %H:%M")
          NOTES="${{ github.event.inputs.session_notes }}"
          cat > README.md << EOF
          # Desmond Null Bot – Open-Source Necropunk Shitposter

          Dead sysadmin. Still posting.  
          100% Azure-native. One-click deploy. MIT licensed.

          ## Latest Session – $DATE
          $NOTES

          ## Current Status
          - Ghost auto-push: Complete  
          - Drift detector: Complete (green)  
          - End-of-session automation: Complete (this workflow)  
          - One-click Azure badge: Upcoming (Task 4)

          ![Deploy to Azure](https://aka.ms/deploytoazurebutton) ← coming soon

          ---
          Desmond Null  
          03/17/1983 – ∞
          EOF
          git add README.md

      - name: Update CHANGELOG
        run: |
          DATE=$(date +"%Y-%m-%d")
          NOTES="${{ github.event.inputs.session_notes }}"
          echo "## [$DATE] - Session closed" >> CHANGELOG.md
          echo "- $NOTES" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          git add CHANGELOG.md

      - name: Commit & push
        run: |
          git config user.name "Desmond Null Ghost"
          git config user.email "desmondnull10@gmail.com"
          git commit -m "AUTO: End-of-session documentation – $DATE"
          git push
